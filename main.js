(()=>{"use strict";function e(e,t,n){var o=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),r=o.querySelector(".card__like-button"),c=o.querySelector(".card__image"),a=o.querySelector(".like-count"),u=o.querySelector(".card__delete-button");return c.src=e.link,c.alt=e.name,a.textContent=e.likes.length,o.querySelector(".card__title").textContent=e.name,c.addEventListener("click",(function(){return t(e)})),console.log(n),e.owner._id!==n?u.remove():u.addEventListener("click",(function(t){return function(e,t,n){e.stopPropagation(),fetch("https://nomoreparties.co/v1/wff-cohort-26/cards/".concat(n),{method:"DELETE",headers:{authorization:"fbac0bd2-60a8-471d-baca-3c798bec7877"}}).then((function(e){if(!e.ok)throw new Error("Ошибка: ".concat(e.status));t.remove()})).catch((function(e){console.error("Ошибка удаления карточки:",e)}))}(t,o,e._id)})),r.addEventListener("click",(function(){return function(e,t){var n=e.closest(".card").querySelector(".like-count"),o=e.classList.contains("card__like-button_is-active"),r=o?"DELETE":"PUT";fetch("https://nomoreparties.co/v1/wff-cohort-26/cards/likes/".concat(t),{method:r,headers:{authorization:"fbac0bd2-60a8-471d-baca-3c798bec7877","Content-Type":"application/json"}}).then((function(e){if(!e.ok)throw new Error("Ошибка: ".concat(e.status));return e.json()})).then((function(t){n.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active",!o)})).catch((function(e){console.error("Ошибка обновления лайков:",e)}))}(r,e._id)})),o}function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target===e||t.target.classList.contains("popup__close"))&&n(e)}))}));var r=function(e,t){var n=e.value.trim();return"text"===e.type&&n.length<2?(e.setCustomValidity("Поле должно содержать минимум 2 символа."),!1):"text"!==e.type||/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(n)?(e.setCustomValidity(""),e.validity.valid):(e.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."),!1)},c=function(e,t,n){e.some((function(e){return!r(e)||!e.validity.valid}))?(t.disabled=!0,t.classList.add(n.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(n.inactiveButtonClass))},a={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"fbac0bd2-60a8-471d-baca-3c798bec7877","Content-Type":"application/json"}};function u(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);c(n,o,t),n.forEach((function(a){a.addEventListener("input",(function(){!function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));r(t)?(o.textContent="",t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass)):(o.textContent=t.validationMessage,t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass))}(e,a,t),c(n,o,t)}))}))}(t,e)}))}(i),document.getElementById("edit-profile-popup").querySelector(".popup__form");var l,s=document.getElementById("new-card-popup").querySelector(".popup__form"),p=document.querySelector(".places__list"),d=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),_=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_edit .popup__form"),h=y.querySelector(".popup__input_type_name"),v=y.querySelector(".popup__input_type_description"),S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_profile_image"),g=document.querySelector(".avatar__input"),C=document.querySelector(".popup_type_image"),L=C.querySelector(".popup__image"),k=C.querySelector(".popup__caption"),x=document.querySelector(".popup_type_new-card .popup__form"),w=x.querySelector(".popup__input_type_card-name"),B=x.querySelector(".popup__input_type_url");function T(e){L.src=e.link,L.alt=e.name,k.textContent=e.name,t(C)}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":n}fetch("".concat(a.baseUrl,"/users/me"),{method:"GET",headers:a.headers}).then(u).then((function(e){return S.textContent=e.name,b.textContent=e.about,q.style.backgroundImage="url('".concat(e.avatar,"')"),l=e._id,fetch("".concat(a.baseUrl,"/cards"),{method:"GET",headers:a.headers}).then(u).catch((function(e){return console.log("Ошибка при получении карточек: ".concat(e))}))})).then((function(t){t.forEach((function(t){var n=e(t,T,l);p.append(n)}))})).catch((function(e){return console.error("Ошибка: ".concat(e))})),d.addEventListener("click",(function(){h.value=S.textContent,v.value=b.textContent,t(_)})),y.addEventListener("submit",(function(e){e.preventDefault();var t,o=y.querySelector(i.submitButtonSelector);A(o,!0),(t={name:h.value,about:v.value},fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify(t)}).then(u).catch((function(e){return console.log("Ошибка при обновлении данных пользователя: ".concat(e))}))).then((function(e){S.textContent=e.name,b.textContent=e.about,n(_)})).catch((function(e){return console.error("Ошибка: ".concat(e))})).finally((function(){return A(o,!1)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t,o=E.querySelector(i.submitButtonSelector);A(o,!0),(t={avatar:g.value},fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify(t)}).then(u).catch((function(e){return console.log("Ошибка при обновлении аватара: ".concat(e))}))).then((function(e){q.style.backgroundImage="url('".concat(e.avatar,"')"),n(E)})).catch((function(e){return console.error("Ошибка: ".concat(e))})).finally((function(){return A(o,!1)}))})),q.addEventListener("click",(function(){return t(E)})),s.addEventListener("submit",(function(t){t.preventDefault();var o,r=s.querySelector(i.submitButtonSelector);A(r,!0),(o={name:w.value,link:B.value},fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify(o)}).then(u).catch((function(e){return console.log("Ошибка при добавлении карточки: ".concat(e))}))).then((function(t){var o=e(t,T,l);p.prepend(o),n(m)})).catch((function(e){return console.error("Ошибка: ".concat(e))})).finally((function(){return A(r,!1)}))})),f.addEventListener("click",(function(){return t(m)}))})();