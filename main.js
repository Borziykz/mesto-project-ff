(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"fbac0bd2-60a8-471d-baca-3c798bec7877","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(n,r,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__like-button"),a=c.querySelector(".card__image"),i=c.querySelector(".like-count"),l=c.querySelector(".card__delete-button");return a.src=n.link,a.alt=n.name,i.textContent=n.likes.length,c.querySelector(".card__title").textContent=n.name,n.likes.some((function(e){return e._id===o}))&&u.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){return r(n)})),n.owner._id!==o?l.remove():l.addEventListener("click",(function(r){return function(n,r,o){n.stopPropagation(),function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(o).then((function(){r.remove()})).catch((function(e){console.error("Ошибка удаления карточки:",e)}))}(r,c,n._id)})),u.addEventListener("click",(function(){return function(n,r){var o=n.closest(".card").querySelector(".like-count"),c=n.classList.contains("card__like-button_is-active");(function(n,r){var o=r?"DELETE":"PUT";return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:o,headers:e.headers}).then(t)})(r,c).then((function(e){o.textContent=e.likes.length,n.classList.toggle("card__like-button_is-active",!c)})).catch((function(e){console.error("Ошибка обновления лайков:",e)}))}(u,n._id)})),c}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}var u=function(e,t){var n=e.value.trim();return"text"===e.type&&n.length<2?(e.setCustomValidity("Поле должно содержать минимум 2 символа."),!1):"text"!==e.type||/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(n)?(e.setCustomValidity(""),e.validity.valid):(e.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."),!1)},a=function(e,t,n){e.some((function(e){return!u(e)||!e.validity.valid}))?(t.disabled=!0,t.classList.add(n.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(n.inactiveButtonClass))},i=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){!function(e,t,n){e.classList.remove(n.inputErrorClass),t.textContent="",t.classList.remove(n.errorClass)}(n,e.querySelector("#".concat(n.id,"-error")),t)})),a(n,r,t)},l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);a(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));u(t)?(r.textContent="",t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass)):(r.textContent=t.validationMessage,t.classList.add(n.inputErrorClass),r.classList.add(n.errorClass))}(e,o,t),a(n,r,t)}))}))}(t,e)}))}(l),document.getElementById("edit-profile-popup").querySelector(".popup__form");var s,p=document.getElementById("new-card-popup").querySelector(".popup__form"),d=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),m=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_edit .popup__form"),h=v.querySelector(".popup__input_type_name"),S=v.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),C=document.querySelector(".popup_type_profile_image"),L=document.querySelector(".avatar__input"),k=document.querySelector(".popup_type_image"),g=k.querySelector(".popup__image"),x=k.querySelector(".popup__caption"),B=document.querySelector(".popup_type_new-card .popup__form"),A=B.querySelector(".popup__input_type_card-name"),T=B.querySelector(".popup__input_type_url"),U=v.querySelector(l.submitButtonSelector),w=C.querySelector(l.submitButtonSelector),D=p.querySelector(l.submitButtonSelector);function P(e){g.src=e.link,g.alt=e.name,x.textContent=e.name,r(k)}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":n}fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then(t).then((function(n){return b.textContent=n.name,q.textContent=n.about,E.style.backgroundImage="url('".concat(n.avatar,"')"),s=n._id,fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then(t)})).then((function(e){e.forEach((function(e){var t=n(e,P,s);d.append(t)}))})).catch((function(e){return console.error("Ошибка: ".concat(e))})),_.addEventListener("click",(function(){i(v,l),h.value=b.textContent,S.value=q.textContent,r(m)})),v.addEventListener("submit",(function(n){var r;n.preventDefault(),I(U,!0),(r={name:h.value,about:S.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify(r)}).then(t)).then((function(e){b.textContent=e.name,q.textContent=e.about,o(m)})).catch((function(e){return console.error("Ошибка: ".concat(e))})).finally((function(){return I(U,!1)}))})),C.addEventListener("submit",(function(n){var r;n.preventDefault(),I(w,!0),(r={avatar:L.value},fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify(r)}).then(t)).then((function(e){E.style.backgroundImage="url('".concat(e.avatar,"')"),o(C)})).catch((function(e){return console.error("Ошибка: ".concat(e))})).finally((function(){return I(w,!1)}))})),p.addEventListener("submit",(function(r){var c;r.preventDefault(),I(D,!0),(c={name:A.value,link:T.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify(c)}).then(t)).then((function(e){var t=n(e,P,s);d.prepend(t),o(y)})).catch((function(e){return console.error("Ошибка: ".concat(e))})).finally((function(){return I(D,!1)}))})),f.addEventListener("click",(function(){A.value="",T.value="",i(B,l),r(y)})),E.addEventListener("click",(function(){L.value="",i(C,l),r(C)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target===e||t.target.classList.contains("popup__close"))&&o(e)}))}))})();